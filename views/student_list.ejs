<%- include("partials/head") %>
    <link rel="stylesheet" href="/styles/allStudent.css">

    <body class="box">
        <main>
            <% if (err) { %>
                <script> alert('<%= err %>')</script>
            <% } %>
            <table border="2">
                <thead>
                    <tr>
                        <th class="Roll">Roll Number</th>
                        <th>Student Name</th>
                        <th>course</th>
                        <th colspan="2" class="action">action (edit / delete)</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let s of student) { %>
                        <tr>
                            <td class="Roll">
                                <%= s.id %>
                            </td>
                            <td>
                                <%= s.student_name %>
                            </td>
                            <td>
                                <%= s.course %>
                            </td>
                            <td><a href="/students/<%= s.id %>"> <img src="https://img.icons8.com/matisse/30/view.png"
                                        alt="student_profile"></a></td>
                                        <!-- <td><a href=""><img src="https://img.icons8.com/color-pixels/32/trash.png"
                                            alt="delete_student"></a></td> -->
                                            <td><button onclick="deleteStudent('<%= s.id %>')" style="border: none; background: none;">
                                                    <img src="https://img.icons8.com/color-pixels/32/trash.png" alt="delete_student" />
                                                </button></td>
                                        </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </main>
        <script>
            async function deleteStudent(id) {
                const confirmed = confirm("Are you sure you want to delete this student?");
                if (!confirmed) return;

                try {
                    const res = await fetch(`/students/${id}`, {
                        method: 'DELETE'
                    });

                    if (res.ok) {
                        alert("Student deleted successfully.");
                        window.location.reload(); // Refresh the page to reflect changes
                    } else {
                        const msg = await res.text();
                        alert("Failed to delete: " + msg);
                    }
                } catch (err) {
                    alert("Server Error: cannot delete student.");
                    // console.error(err);
                }
            }
        </script>
<%- include('partials/footer') %>
    </body>